<!DOCTYPE html>
<html lang="zh-CN">
<head>
  <meta charset="UTF-8">
<meta name="viewport" content="width=device-width">
<meta name="theme-color" content="#222"><meta name="generator" content="Hexo 7.3.0">

  <link rel="apple-touch-icon" sizes="180x180" href="/images/apple-touch-icon-next.png">
  <link rel="icon" type="image/png" sizes="32x32" href="/images/favicon-32x32-next.png">
  <link rel="icon" type="image/png" sizes="16x16" href="/images/favicon-16x16-next.png">
  <link rel="mask-icon" href="/images/logo.svg" color="#222">

<link rel="stylesheet" href="/css/main.css">



<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.7.2/css/all.min.css" integrity="sha256-dABdfBfUoC8vJUBOwGVdm8L9qlMWaHTIfXt+7GnZCIo=" crossorigin="anonymous">
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/animate.css/3.1.1/animate.min.css" integrity="sha256-PR7ttpcvz8qrF57fur/yAx1qXMFJeJFiA6pSzWi0OIE=" crossorigin="anonymous">

<script class="next-config" data-name="main" type="application/json">{"hostname":"stanhe.github.io","root":"/","images":"/images","scheme":"Muse","darkmode":false,"version":"8.22.0","exturl":false,"sidebar":{"position":"left","width_expanded":320,"width_dual_column":240,"display":"post","padding":18,"offset":12},"hljswrap":true,"copycode":{"enable":false,"style":null},"fold":{"enable":false,"height":500},"bookmark":{"enable":false,"color":"#222","save":"auto"},"mediumzoom":false,"lazyload":false,"pangu":false,"comments":{"style":"tabs","active":null,"storage":true,"lazyload":false,"nav":null},"stickytabs":false,"motion":{"enable":true,"async":false,"duration":200,"transition":{"menu_item":"fadeInDown","post_block":"fadeIn","post_header":"fadeInDown","post_body":"fadeInDown","coll_header":"fadeInLeft","sidebar":"fadeInUp"}},"i18n":{"placeholder":"搜索...","empty":"没有找到任何搜索结果：${query}","hits_time":"找到 ${hits} 个搜索结果（用时 ${time} 毫秒）","hits":"找到 ${hits} 个搜索结果"}}</script><script src="/js/config.js" defer></script>

    <meta name="description" content="配置GCM 、FCM 、 Google-Map (全程科学上网)">
<meta property="og:type" content="article">
<meta property="og:title" content="整理Google接入">
<meta property="og:url" content="https://stanhe.github.io/2016/10/04/google_integerate/index.html">
<meta property="og:site_name" content="朝乾夕惕,虚怀如谷">
<meta property="og:description" content="配置GCM 、FCM 、 Google-Map (全程科学上网)">
<meta property="og:locale" content="zh_CN">
<meta property="og:image" content="http://oanvj2lsv.bkt.clouddn.com/google/googleapi.png">
<meta property="og:image" content="http://oanvj2lsv.bkt.clouddn.com/google/api/api1.png">
<meta property="og:image" content="http://oanvj2lsv.bkt.clouddn.com/google/api/api2.png">
<meta property="article:published_time" content="2016-10-04T12:37:31.000Z">
<meta property="article:modified_time" content="2025-03-21T16:10:24.979Z">
<meta property="article:author" content="Stanhe">
<meta property="article:tag" content="google">
<meta name="twitter:card" content="summary">
<meta name="twitter:image" content="http://oanvj2lsv.bkt.clouddn.com/google/googleapi.png">


<link rel="canonical" href="https://stanhe.github.io/2016/10/04/google_integerate/">


<script class="next-config" data-name="page" type="application/json">{"sidebar":"","isHome":false,"isPost":true,"lang":"zh-CN","comments":true,"permalink":"https://stanhe.github.io/2016/10/04/google_integerate/","path":"2016/10/04/google_integerate/","title":"整理Google接入"}</script>

<script class="next-config" data-name="calendar" type="application/json">""</script>
<title>整理Google接入 | 朝乾夕惕,虚怀如谷</title>
  








  
  <script src="https://cdnjs.cloudflare.com/ajax/libs/animejs/3.2.1/anime.min.js" integrity="sha256-XL2inqUJaslATFnHdJOi9GfQ60on8Wx1C2H8DYiN1xY=" crossorigin="anonymous" defer></script>
<script src="/js/utils.js" defer></script><script src="/js/motion.js" defer></script><script src="/js/sidebar.js" defer></script><script src="/js/next-boot.js" defer></script>

  






  





  <noscript>
    <link rel="stylesheet" href="/css/noscript.css">
  </noscript>
</head>

<body itemscope itemtype="http://schema.org/WebPage" class="use-motion">
  <div class="headband"></div>

  <main class="main">
    <div class="column">
      <header class="header" itemscope itemtype="http://schema.org/WPHeader"><div class="site-brand-container">
  <div class="site-nav-toggle">
    <div class="toggle" aria-label="切换导航栏" role="button">
    </div>
  </div>

  <div class="site-meta">

    <a href="/" class="brand" rel="start">
      <i class="logo-line"></i>
      <p class="site-title">朝乾夕惕,虚怀如谷</p>
      <i class="logo-line"></i>
    </a>
      <p class="site-subtitle" itemprop="description">与喧嚣低调同行</p>
  </div>

  <div class="site-nav-right">
    <div class="toggle popup-trigger" aria-label="搜索" role="button">
    </div>
  </div>
</div>







</header>
        
  
  <aside class="sidebar">

    <div class="sidebar-inner sidebar-nav-active sidebar-toc-active">
      <ul class="sidebar-nav">
        <li class="sidebar-nav-toc">
          文章目录
        </li>
        <li class="sidebar-nav-overview">
          站点概览
        </li>
      </ul>

      <div class="sidebar-panel-container">
        <!--noindex-->
        <div class="post-toc-wrap sidebar-panel">
            <div class="post-toc animated"><ol class="nav"><li class="nav-item nav-level-2"><a class="nav-link" href="#GCM"><span class="nav-number">1.</span> <span class="nav-text">GCM</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#Set-up-a-GCM-Client-App-on-Android"><span class="nav-number">1.1.</span> <span class="nav-text">Set up a GCM Client App on Android</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E5%9C%A8Firebase%E6%8E%A7%E5%88%B6%E5%8F%B0%E6%B3%A8%E5%86%8C"><span class="nav-number">1.2.</span> <span class="nav-text">在Firebase控制台注册</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E9%85%8D%E7%BD%AEproject"><span class="nav-number">1.3.</span> <span class="nav-text">配置project</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E5%AF%B9%E5%BA%94%E6%96%87%E6%A1%A3-Edit-Your-Application%E2%80%99s-Manifest"><span class="nav-number">1.4.</span> <span class="nav-text">对应文档(Edit Your Application’s Manifest)</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#FCM"><span class="nav-number">2.</span> <span class="nav-text">FCM</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#FCM-gradle%E9%85%8D%E7%BD%AE"><span class="nav-number">2.1.</span> <span class="nav-text">FCM gradle配置</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#FCM-Mainifests%E5%8F%8A%E7%B1%BB%E8%AE%BE%E7%BD%AE"><span class="nav-number">2.2.</span> <span class="nav-text">FCM Mainifests及类设置</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#Google-Map"><span class="nav-number">3.</span> <span class="nav-text">Google Map</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#%E5%9C%A8-Google-Developers-Console-%E4%B8%AD%E5%88%9B%E5%BB%BA-API-%E9%A1%B9%E7%9B%AE"><span class="nav-number">3.1.</span> <span class="nav-text">在 Google Developers Console 中创建 API 项目</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E5%90%91%E6%82%A8%E7%9A%84%E5%BA%94%E7%94%A8%E6%B7%BB%E5%8A%A0-API-%E5%AF%86%E9%92%A5"><span class="nav-number">3.2.</span> <span class="nav-text">向您的应用添加 API 密钥</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E5%AF%BC%E5%85%A5%E5%92%8C%E7%89%B9%E6%AE%8A%E6%98%BE%E7%A4%BA%E7%9A%84samples"><span class="nav-number">3.3.</span> <span class="nav-text">导入和特殊显示的samples</span></a></li></ol></li></ol></div>
        </div>
        <!--/noindex-->

        <div class="site-overview-wrap sidebar-panel">
          <div class="site-author animated" itemprop="author" itemscope itemtype="http://schema.org/Person">
  <p class="site-author-name" itemprop="name">Stanhe</p>
  <div class="site-description" itemprop="description">灵魂躁动不安</div>
</div>
<div class="site-state-wrap animated">
  <nav class="site-state">
      <div class="site-state-item site-state-posts">
        <a href="/archives/">
          <span class="site-state-item-count">58</span>
          <span class="site-state-item-name">日志</span>
        </a>
      </div>
      <div class="site-state-item site-state-categories">
          <a href="/categories/">
        <span class="site-state-item-count">3</span>
        <span class="site-state-item-name">分类</span></a>
      </div>
      <div class="site-state-item site-state-tags">
          <a href="/tags/">
        <span class="site-state-item-count">38</span>
        <span class="site-state-item-name">标签</span></a>
      </div>
  </nav>
</div>

        </div>
      </div>
    </div>

    
  </aside>


    </div>

    <div class="main-inner post posts-expand">


  


<div class="post-block">
  
  

  <article itemscope itemtype="http://schema.org/Article" class="post-content" lang="zh-CN">
    <link itemprop="mainEntityOfPage" href="https://stanhe.github.io/2016/10/04/google_integerate/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.gif">
      <meta itemprop="name" content="Stanhe">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="朝乾夕惕,虚怀如谷">
      <meta itemprop="description" content="灵魂躁动不安">
    </span>

    <span hidden itemprop="post" itemscope itemtype="http://schema.org/CreativeWork">
      <meta itemprop="name" content="整理Google接入 | 朝乾夕惕,虚怀如谷">
      <meta itemprop="description" content="">
    </span>
      <header class="post-header">
        <h1 class="post-title" itemprop="name headline">
          整理Google接入
        </h1>

        <div class="post-meta-container">
          <div class="post-meta">
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar"></i>
      </span>
      <span class="post-meta-item-text">发表于</span>

      <time title="创建时间：2016-10-04 20:37:31" itemprop="dateCreated datePublished" datetime="2016-10-04T20:37:31+08:00">2016-10-04</time>
    </span>
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar-check"></i>
      </span>
      <span class="post-meta-item-text">更新于</span>
      <time title="修改时间：2025-03-22 00:10:24" itemprop="dateModified" datetime="2025-03-22T00:10:24+08:00">2025-03-22</time>
    </span>

  
</div>

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody"><p><img src="http://oanvj2lsv.bkt.clouddn.com/google/googleapi.png" alt="google"></p>
<center> 配置GCM 、FCM 、 Google-Map (全程科学上网)</center>
<span id="more"></span>
## API
[API管理器(配置入口)](https://console.developers.google.com/apis/library?project=hauyan-8b259)

<p><img src="http://oanvj2lsv.bkt.clouddn.com/google/api/api1.png" alt="api"></p>
<hr>
<h2 id="GCM"><a href="#GCM" class="headerlink" title="GCM"></a>GCM</h2><p> <a target="_blank" rel="noopener" href="https://developers.google.com/cloud-messaging/gcm?hl=zh-cn">真のGCM文档</a><br>通过 API管理器 进入的是FCM 的配置文档，FCM 兼容GCM 同时更加简洁，并提供更多的可用服务。</p>
<p>以下配置参照<a target="_blank" rel="noopener" href="https://developers.google.com/cloud-messaging/android/client?hl=zh-cn">GCM设置文档</a>和 <a target="_blank" rel="noopener" href="https://github.com/googlesamples/google-services/tree/master/android/gcm/app/src/main/java/gcm/play/android/samples/com/gcmquickstart">GoogleSamples</a>，找代码也是一个复杂的过程，索性一并贴出。</p>
<h3 id="Set-up-a-GCM-Client-App-on-Android"><a href="#Set-up-a-GCM-Client-App-on-Android" class="headerlink" title="Set up a GCM Client App on Android"></a>Set up a GCM Client App on Android</h3><p><a target="_blank" rel="noopener" href="https://developers.google.com/cloud-messaging/android/client?hl=zh-cn">GCM Clients 传送门</a></p>
<p>假设你的设备支持GCM，这里有一份缩减版：</p>
<h3 id="在Firebase控制台注册"><a href="#在Firebase控制台注册" class="headerlink" title="在Firebase控制台注册"></a>在Firebase控制台注册</h3><p>对应文档(Create an API project)</p>
<p>1.<a target="_blank" rel="noopener" href="https://console.firebase.google.com/?hl=zh-cn">注册项目</a>，已有相关项目点击导入.没有点击新建.</p>
<p>2.点击添加Firebase到你的应用，然后继续，注意包名，一定要对应app的build.gradle中的applicationId,SHA1(android studio 右边gradle task面板 ：app–&gt;Tasks–&gt;android–&gt;signingReport 或者：Android studio 下方控制台 .&#x2F;gradlew signingReport)，完成后下载配置文件。如果要重新下载配置文件：项目右上角-&gt;管理-&gt;下载最新配置文件(下载该项目的google-servers.json)</p>
<p>3.将下载好的google-services.json添加到app&#x2F;目录下</p>
<h3 id="配置project"><a href="#配置project" class="headerlink" title="配置project"></a>配置project</h3><p>对应文档（Add the configuration file to your project）</p>
<p>1.添加依赖到 project-level <strong>build.gradle</strong>:</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">classpath &#x27;com.google.gms:google-services:3.0.0&#x27;</span><br></pre></td></tr></table></figure>
<p>2.添加插件和依赖库到 app-level <strong>build.gradle</strong></p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">apply plugin: &#x27;com.google.gms.google-services&#x27;</span><br><span class="line"></span><br><span class="line">dependencies &#123;</span><br><span class="line">  compile &quot;com.google.android.gms:play-services-gcm:9.6.1&quot;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>注意插件是添加在顶部，不要放到Android内，依赖默认版本 9.6.1,编译不过建议改为 9.0.0</p>
<h3 id="对应文档-Edit-Your-Application’s-Manifest"><a href="#对应文档-Edit-Your-Application’s-Manifest" class="headerlink" title="对应文档(Edit Your Application’s Manifest)"></a>对应文档(Edit Your Application’s Manifest)</h3><p>1.添加权限 和 service</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br></pre></td><td class="code"><pre><span class="line">&lt;manifest package=&quot;com.example.gcm&quot; ...&gt;</span><br><span class="line"></span><br><span class="line">    &lt;uses-sdk android:minSdkVersion=&quot;8&quot; android:targetSdkVersion=&quot;17&quot;/&gt;</span><br><span class="line">    &lt;!--GCM 权限--&gt;</span><br><span class="line">    &lt;uses-permission android:name=&quot;android.permission.WAKE_LOCK&quot; /&gt;</span><br><span class="line">    &lt;permission android:name=&quot;&lt;your-package-name&gt;.permission.C2D_MESSAGE&quot;</span><br><span class="line">        android:protectionLevel=&quot;signature&quot; /&gt;</span><br><span class="line">    &lt;uses-permission android:name=&quot;&lt;your-package-name&gt;.permission.C2D_MESSAGE&quot; /&gt;</span><br><span class="line">    &lt;!--GCM 权限 end--&gt;</span><br><span class="line">    &lt;application ...&gt;</span><br><span class="line">    &lt;!--GCM receiver and service--&gt;</span><br><span class="line">        &lt;receiver</span><br><span class="line">            android:name=&quot;com.google.android.gms.gcm.GcmReceiver&quot;</span><br><span class="line">            android:exported=&quot;true&quot;</span><br><span class="line">            android:permission=&quot;com.google.android.c2dm.permission.SEND&quot; &gt;</span><br><span class="line">            &lt;intent-filter&gt;</span><br><span class="line">                &lt;action android:name=&quot;com.google.android.c2dm.intent.RECEIVE&quot; /&gt;</span><br><span class="line">                &lt;action android:name=&quot;com.google.android.c2dm.intent.REGISTRATION&quot; /&gt; //support pre-4.4 KitKat devices</span><br><span class="line">                &lt;category android:name=&quot;&lt;your-package-name&gt;&quot; /&gt;</span><br><span class="line">            &lt;/intent-filter&gt;</span><br><span class="line">        &lt;/receiver&gt;</span><br><span class="line">        &lt;service</span><br><span class="line">            android:name=&quot;com.example.MyGcmListenerService&quot;//继承GcmListenerService 的自定义类</span><br><span class="line">            android:exported=&quot;false&quot; &gt;</span><br><span class="line">            &lt;intent-filter&gt;</span><br><span class="line">                &lt;action android:name=&quot;com.google.android.c2dm.intent.RECEIVE&quot; /&gt;</span><br><span class="line">            &lt;/intent-filter&gt;</span><br><span class="line">        &lt;/service&gt;</span><br><span class="line">        &lt;service</span><br><span class="line">            android:name=&quot;com.example.MyInstanceIDListenerService&quot;//继承InstanceIDListenerService 的自定义类</span><br><span class="line">            android:exported=&quot;false&quot;&gt;</span><br><span class="line">            &lt;intent-filter&gt;</span><br><span class="line">                &lt;action android:name=&quot;com.google.android.gms.iid.InstanceID&quot; /&gt;</span><br><span class="line">            &lt;/intent-filter&gt;</span><br><span class="line">        &lt;/service&gt;</span><br><span class="line">        &lt;service</span><br><span class="line">            android:name=&quot;gcm.play.android.samples.com.gcmquickstart.RegistrationIntentService&quot;//继承RegistrationIntentService 的自定义类</span><br><span class="line">            android:exported=&quot;false&quot;&gt;</span><br><span class="line">        &lt;/service&gt;</span><br><span class="line">    &lt;!--GCM receiver and service end--&gt;</span><br><span class="line">    &lt;/application&gt;</span><br><span class="line"></span><br><span class="line">&lt;/manifest&gt;</span><br></pre></td></tr></table></figure>
<p>注意：&lt; your-package-name &gt; 这里要设置为gradle中的applicationId.</p>
<p>2.自定义service类及Activiy开启服务</p>
<p>从manifest中看到需要实现3个service类</p>
<p>PreferCode.java</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">public class PreferCode &#123;</span><br><span class="line"></span><br><span class="line">    public static final String SENT_TOKEN_TO_SERVER = &quot;sentTokenToServer&quot;;</span><br><span class="line">    public static final String REGISTRATION_COMPLETE = &quot;registrationComplete&quot;;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p> MyGcmListenerService.java</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br></pre></td><td class="code"><pre><span class="line">public class MyGcmListenerService extends GcmListenerService &#123;</span><br><span class="line"></span><br><span class="line">    public static final String TAG = &quot;MyGcmListenerService&quot;;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">    /**</span><br><span class="line">     * Called when message is received.</span><br><span class="line">     *</span><br><span class="line">     * @param from SenderID of the sender.</span><br><span class="line">     * @param data Data bundle containing message data as key/value pairs.</span><br><span class="line">     *             For Set of keys use data.keySet().</span><br><span class="line">     */</span><br><span class="line">    // [START receive_message]</span><br><span class="line">    @Override</span><br><span class="line">    public void onMessageReceived(String from, Bundle data) &#123;</span><br><span class="line">        String message = &quot;&quot;;</span><br><span class="line">        try &#123;</span><br><span class="line">            if(data!=null) &#123;</span><br><span class="line">                message = data.getString(&quot;message&quot;);</span><br><span class="line">                Log.d(&quot;received message&quot;, &quot;From: &quot; + from);</span><br><span class="line">                Log.d(&quot;received message&quot;, &quot;Message: &quot; + message);</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;catch (Exception e)&#123;</span><br><span class="line">            e.printStackTrace();</span><br><span class="line">        &#125;</span><br><span class="line">        if (from.startsWith(&quot;/topics/&quot;)) &#123;</span><br><span class="line">            // message received from some topic.</span><br><span class="line">        &#125; else &#123;</span><br><span class="line">            // normal downstream message.</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        // [START_EXCLUDE]</span><br><span class="line">        /**</span><br><span class="line">         * Production applications would usually process the message here.</span><br><span class="line">         * Eg: - Syncing with server.</span><br><span class="line">         *     - Store message in local database.</span><br><span class="line">         *     - Update UI.</span><br><span class="line">         */</span><br><span class="line"></span><br><span class="line">        /**</span><br><span class="line">         * In some cases it may be useful to show a notification indicating to the user</span><br><span class="line">         * that a message was received.</span><br><span class="line">         */</span><br><span class="line">        if (Paper.book().read(Utility.NOTIFICATION,Utility.NOTIFICATION_OPEN).equals(Utility.NOTIFICATION_OPEN) &amp;&amp; !TextUtils.isEmpty(message))</span><br><span class="line">            sendNotification(message);</span><br><span class="line">        // [END_EXCLUDE]</span><br><span class="line">    &#125;</span><br><span class="line">    // [END receive_message]</span><br><span class="line"></span><br><span class="line">    /**</span><br><span class="line">     * Create and show a simple notification containing the received GCM message.</span><br><span class="line">     *</span><br><span class="line">     * @param message GCM message received.</span><br><span class="line">     */</span><br><span class="line">    private void sendNotification(String message) &#123;</span><br><span class="line">        Intent intent = new Intent(this, MainActivity.class);</span><br><span class="line">        intent.addFlags(Intent.FLAG_ACTIVITY_NEW_TASK);</span><br><span class="line">        PendingIntent pendingIntent = PendingIntent.getActivity(this, 0 /* Request code */, intent,</span><br><span class="line">                PendingIntent.FLAG_ONE_SHOT);</span><br><span class="line"></span><br><span class="line">        Uri defaultSoundUri = RingtoneManager.getDefaultUri(RingtoneManager.TYPE_NOTIFICATION);</span><br><span class="line">        NotificationCompat.Builder notificationBuilder = new NotificationCompat.Builder(this)</span><br><span class="line">                .setSmallIcon(R.mipmap.homepage_image)</span><br><span class="line">                .setContentTitle(getApplicationName(this))</span><br><span class="line">                .setContentText(message)</span><br><span class="line">                .setAutoCancel(true)</span><br><span class="line">                .setSound(defaultSoundUri)</span><br><span class="line">                .setContentIntent(pendingIntent);</span><br><span class="line"></span><br><span class="line">        NotificationManager notificationManager =</span><br><span class="line">                (NotificationManager) getSystemService(Context.NOTIFICATION_SERVICE);</span><br><span class="line"></span><br><span class="line">        notificationManager.notify(0 /* ID of notification */, notificationBuilder.build());</span><br><span class="line">    &#125;</span><br><span class="line">    public static String getApplicationName(Context context) &#123;</span><br><span class="line">        int stringId = context.getApplicationInfo().labelRes;</span><br><span class="line">        return context.getString(stringId);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>MyInstanceIDListenerService.java</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line">public class MyInstanceIDListenerService extends InstanceIDListenerService &#123;</span><br><span class="line">    public static final String TAG = &quot;MyInstanceIDListenerService&quot;;</span><br><span class="line"></span><br><span class="line">    /**</span><br><span class="line">     * Called if InstanceID token is updated. This may occur if the security of</span><br><span class="line">     * the previous token had been compromised. This call is initiated by the</span><br><span class="line">     * InstanceID provider.</span><br><span class="line">     */</span><br><span class="line">    // [START refresh_token]</span><br><span class="line">    @Override</span><br><span class="line">    public void onTokenRefresh() &#123;</span><br><span class="line">        // Fetch updated Instance ID token and notify our app&#x27;s server of any changes (if applicable).</span><br><span class="line">        Intent intent = new Intent(this, RegistrationIntentService.class);</span><br><span class="line">        startService(intent);</span><br><span class="line">    &#125;</span><br><span class="line">    // [END refresh_token]</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure>
<p>RegistrationIntentService.java</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br></pre></td><td class="code"><pre><span class="line">public class RegistrationIntentService extends IntentService&#123;</span><br><span class="line">    public static final String TAG = &quot;RegistrationIntentService&quot;;</span><br><span class="line">    private static final String[] TOPICS = &#123;&quot;global&quot;&#125;;</span><br><span class="line">    /**</span><br><span class="line">     * Creates an IntentService.  Invoked by your subclass&#x27;s constructor.</span><br><span class="line">     */</span><br><span class="line">    public RegistrationIntentService() &#123;</span><br><span class="line">        super(TAG);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">    @Override</span><br><span class="line">    protected void onHandleIntent(Intent intent) &#123;</span><br><span class="line">        SharedPreferences sharedPreferences = PreferenceManager.getDefaultSharedPreferences(this);</span><br><span class="line"></span><br><span class="line">        try &#123;</span><br><span class="line">            // [START register_for_gcm]</span><br><span class="line">            // Initially this call goes out to the network to retrieve the token, subsequent calls</span><br><span class="line">            // are local.</span><br><span class="line">            // R.string.gcm_defaultSenderId (the Sender ID) is typically derived from google-services.json.</span><br><span class="line">            // See https://developers.google.com/cloud-messaging/android/start for details on this file.</span><br><span class="line">            // [START get_token]</span><br><span class="line">            InstanceID instanceID = InstanceID.getInstance(getApplicationContext());</span><br><span class="line">            String token = instanceID.getToken(getString(R.string.gcm_defaultSenderId), GoogleCloudMessaging.INSTANCE_ID_SCOPE, null);</span><br><span class="line">            // [END get_token]</span><br><span class="line">            Log.i(TAG, &quot;GCM Registration Token: &quot; + token);</span><br><span class="line"></span><br><span class="line">            // TODO: Implement this method to send any registration to your app&#x27;s servers.</span><br><span class="line">            sendRegistrationToServer(token);</span><br><span class="line"></span><br><span class="line">            // Subscribe to topic channels</span><br><span class="line">            subscribeTopics(token);</span><br><span class="line"></span><br><span class="line">            // You should store a boolean that indicates whether the generated token has been</span><br><span class="line">            // sent to your server. If the boolean is false, send the token to your server,</span><br><span class="line">            // otherwise your server should have already received the token.</span><br><span class="line">            sharedPreferences.edit().putBoolean(PreferCode.SENT_TOKEN_TO_SERVER, true).apply();</span><br><span class="line">            // [END register_for_gcm]</span><br><span class="line">        &#125; catch (Exception e) &#123;</span><br><span class="line">            Log.i(TAG, &quot;Failed to complete token refresh&quot;, e);</span><br><span class="line">            // If an exception happens while fetching the new token or updating our registration data</span><br><span class="line">            // on a third-party server, this ensures that we&#x27;ll attempt the update at a later time.</span><br><span class="line">            sharedPreferences.edit().putBoolean(PreferCode.SENT_TOKEN_TO_SERVER, false).apply();</span><br><span class="line">        &#125;</span><br><span class="line">        // Notify UI that registration has completed, so the progress indicator can be hidden.</span><br><span class="line">        Intent registrationComplete = new Intent(PreferCode.REGISTRATION_COMPLETE);</span><br><span class="line">        LocalBroadcastManager.getInstance(this).sendBroadcast(registrationComplete);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    /**</span><br><span class="line">     * Persist registration to third-party servers.</span><br><span class="line">     *</span><br><span class="line">     * Modify this method to associate the user&#x27;s GCM registration token with any server-side account</span><br><span class="line">     * maintained by your application.</span><br><span class="line">     *</span><br><span class="line">     * @param token The new token.</span><br><span class="line">     */</span><br><span class="line">    private void sendRegistrationToServer(String token) &#123;</span><br><span class="line">        Map&lt;String ,String &gt; params = new HashMap&lt;&gt;();</span><br><span class="line">        params.put(&quot;device&quot;,&quot;android&quot;);</span><br><span class="line">        params.put(&quot;token&quot;,token);</span><br><span class="line">        HttpUtils.simplePost(Api.sendToken, this, params, new RequestCBK() &#123;</span><br><span class="line">            @Override</span><br><span class="line">            public void onResponse(JSONObject response) &#123;</span><br><span class="line">                Log.i(TAG,response.toString());</span><br><span class="line">            &#125;</span><br><span class="line"></span><br><span class="line">            @Override</span><br><span class="line">            public void onErrorResponse() &#123;</span><br><span class="line"></span><br><span class="line">            &#125;</span><br><span class="line">        &#125;);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    /**</span><br><span class="line">     * Subscribe to any GCM topics of interest, as defined by the TOPICS constant.</span><br><span class="line">     *</span><br><span class="line">     * @param token GCM token</span><br><span class="line">     * @throws IOException if unable to reach the GCM PubSub service</span><br><span class="line">     */</span><br><span class="line">    // [START subscribe_topics]</span><br><span class="line">    private void subscribeTopics(String token) throws IOException &#123;</span><br><span class="line">        GcmPubSub pubSub = GcmPubSub.getInstance(this);</span><br><span class="line">        for (String topic : TOPICS) &#123;</span><br><span class="line">            pubSub.subscribe(token, &quot;/topics/&quot; + topic, null);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    // [END subscribe_topics]</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure>
<p>Acitivity中设置监听开启服务</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br></pre></td><td class="code"><pre><span class="line">public class MainActivity extends AppCompatActivity &#123;</span><br><span class="line"></span><br><span class="line">    private static final int PLAY_SERVICES_RESOLUTION_REQUEST = 9000;</span><br><span class="line">    private static final String TAG = &quot;MainActivity&quot;;</span><br><span class="line"></span><br><span class="line">    private BroadcastReceiver mRegistrationBroadcastReceiver;</span><br><span class="line">    private ProgressBar mRegistrationProgressBar;</span><br><span class="line">    private TextView mInformationTextView;</span><br><span class="line">    private boolean isReceiverRegistered;</span><br><span class="line"></span><br><span class="line">    @Override</span><br><span class="line">    protected void onCreate(Bundle savedInstanceState) &#123;</span><br><span class="line">        super.onCreate(savedInstanceState);</span><br><span class="line">        setContentView(R.layout.activity_main);</span><br><span class="line"></span><br><span class="line">        mRegistrationProgressBar = (ProgressBar) findViewById(R.id.registrationProgressBar);</span><br><span class="line">        mRegistrationBroadcastReceiver = new BroadcastReceiver() &#123;</span><br><span class="line">            @Override</span><br><span class="line">            public void onReceive(Context context, Intent intent) &#123;</span><br><span class="line">                mRegistrationProgressBar.setVisibility(ProgressBar.GONE);</span><br><span class="line">                SharedPreferences sharedPreferences =</span><br><span class="line">                        PreferenceManager.getDefaultSharedPreferences(context);</span><br><span class="line">                boolean sentToken = sharedPreferences</span><br><span class="line">                        .getBoolean(QuickstartPreferences.SENT_TOKEN_TO_SERVER, false);</span><br><span class="line">                if (sentToken) &#123;</span><br><span class="line">                    mInformationTextView.setText(getString(R.string.gcm_send_message));</span><br><span class="line">                &#125; else &#123;</span><br><span class="line">                    mInformationTextView.setText(getString(R.string.token_error_message));</span><br><span class="line">                &#125;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;;</span><br><span class="line">        mInformationTextView = (TextView) findViewById(R.id.informationTextView);</span><br><span class="line"></span><br><span class="line">        // Registering BroadcastReceiver</span><br><span class="line">        registerReceiver();</span><br><span class="line"></span><br><span class="line">        if (checkPlayServices()) &#123;</span><br><span class="line">            // Start IntentService to register this application with GCM.</span><br><span class="line">            Intent intent = new Intent(this, RegistrationIntentService.class);</span><br><span class="line">            startService(intent);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    @Override</span><br><span class="line">    protected void onResume() &#123;</span><br><span class="line">        super.onResume();</span><br><span class="line">        registerReceiver();</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    @Override</span><br><span class="line">    protected void onPause() &#123;</span><br><span class="line">        LocalBroadcastManager.getInstance(this).unregisterReceiver(mRegistrationBroadcastReceiver);</span><br><span class="line">        isReceiverRegistered = false;</span><br><span class="line">        super.onPause();</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    private void registerReceiver()&#123;</span><br><span class="line">        if(!isReceiverRegistered) &#123;</span><br><span class="line">            LocalBroadcastManager.getInstance(this).registerReceiver(mRegistrationBroadcastReceiver,</span><br><span class="line">                    new IntentFilter(QuickstartPreferences.REGISTRATION_COMPLETE));</span><br><span class="line">            isReceiverRegistered = true;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    /**</span><br><span class="line">     * Check the device to make sure it has the Google Play Services APK. If</span><br><span class="line">     * it doesn&#x27;t, display a dialog that allows users to download the APK from</span><br><span class="line">     * the Google Play Store or enable it in the device&#x27;s system settings.</span><br><span class="line">     */</span><br><span class="line">    private boolean checkPlayServices() &#123;</span><br><span class="line">        GoogleApiAvailability apiAvailability = GoogleApiAvailability.getInstance();</span><br><span class="line">        int resultCode = apiAvailability.isGooglePlayServicesAvailable(this);</span><br><span class="line">        if (resultCode != ConnectionResult.SUCCESS) &#123;</span><br><span class="line">            if (apiAvailability.isUserResolvableError(resultCode)) &#123;</span><br><span class="line">                apiAvailability.getErrorDialog(this, resultCode, PLAY_SERVICES_RESOLUTION_REQUEST)</span><br><span class="line">                        .show();</span><br><span class="line">            &#125; else &#123;</span><br><span class="line">                Log.i(TAG, &quot;This device is not supported.&quot;);</span><br><span class="line">                finish();</span><br><span class="line">            &#125;</span><br><span class="line">            return false;</span><br><span class="line">        &#125;</span><br><span class="line">        return true;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<hr>
<h2 id="FCM"><a href="#FCM" class="headerlink" title="FCM"></a>FCM</h2><p>添加FCM SDK到项目中。</p>
<p>获取google-services.json同GCM，<strong>build.gradle</strong> 配置和 <strong>2.1.2</strong> 略有不同</p>
<h3 id="FCM-gradle配置"><a href="#FCM-gradle配置" class="headerlink" title="FCM gradle配置"></a>FCM gradle配置</h3><p>首先，请向您的根级 build.gradle 文件添加一条规则，以包含 Google 服务插件：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">buildscript &#123;</span><br><span class="line">    // ...</span><br><span class="line">    dependencies &#123;</span><br><span class="line">        // ...</span><br><span class="line">        classpath &#x27;com.google.gms:google-services:3.0.0&#x27;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>然后在您的模块 Gradle 文件（通常为 app&#x2F;build.gradle）中，在文件底部添加 apply plugin 行，以启用 Gradle 插件：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line">apply plugin: &#x27;com.android.application&#x27;</span><br><span class="line"></span><br><span class="line">android &#123;</span><br><span class="line">  // ...</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">dependencies &#123;</span><br><span class="line">  // ...</span><br><span class="line">  compile &#x27;com.google.firebase:firebase-core:9.6.1&#x27; // Firebase sdk</span><br><span class="line"></span><br><span class="line">  compile &#x27;com.google.firebase:firebase-messaging:9.6.1&#x27; // FCM 依赖</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">// ADD THIS AT THE BOTTOM</span><br><span class="line">apply plugin: &#x27;com.google.gms.google-services&#x27;</span><br></pre></td></tr></table></figure>
<p>您还应为自己想使用的 <a target="_blank" rel="noopener" href="https://firebase.google.com/docs/android/setup">Firebase SDK</a> 添加依赖项</p>
<h3 id="FCM-Mainifests及类设置"><a href="#FCM-Mainifests及类设置" class="headerlink" title="FCM Mainifests及类设置"></a>FCM Mainifests及类设置</h3><p> 下面是FCM的简洁之处  <a target="_blank" rel="noopener" href="https://firebase.google.com/docs/samples/#android">示例</a></p>
<p> 贴代码：</p>
<p> AndroidManifest.xml</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br></pre></td><td class="code"><pre><span class="line">&lt;?xml version=&quot;1.0&quot; encoding=&quot;utf-8&quot;?&gt;</span><br><span class="line">&lt;manifest xmlns:android=&quot;http://schemas.android.com/apk/res/android&quot;</span><br><span class="line">    package=&quot;com.google.firebase.quickstart.fcm&quot;&gt;</span><br><span class="line"></span><br><span class="line">    &lt;application</span><br><span class="line">        android:allowBackup=&quot;true&quot;</span><br><span class="line">        android:icon=&quot;@mipmap/ic_launcher&quot;</span><br><span class="line">        android:label=&quot;@string/app_name&quot;</span><br><span class="line">        android:theme=&quot;@style/AppTheme&quot;&gt;</span><br><span class="line">        &lt;!-- [START fcm_default_icon] --&gt;</span><br><span class="line">        &lt;!-- Set custom default icon. This is used when no icon is set for incoming notification messages.</span><br><span class="line">             See README(https://goo.gl/l4GJaQ) for more. --&gt;</span><br><span class="line">        &lt;meta-data</span><br><span class="line">            android:name=&quot;com.google.firebase.messaging.default_notification_icon&quot;</span><br><span class="line">            android:resource=&quot;@drawable/ic_stat_ic_notification&quot; /&gt;</span><br><span class="line">        &lt;!-- Set color used with incoming notification messages. This is used when no color is set for the incoming</span><br><span class="line">             notification message. See README(https://goo.gl/6BKBk7) for more. --&gt;</span><br><span class="line">        &lt;meta-data</span><br><span class="line">            android:name=&quot;com.google.firebase.messaging.default_notification_color&quot;</span><br><span class="line">            android:resource=&quot;@color/colorAccent&quot; /&gt;</span><br><span class="line">        &lt;!-- [END fcm_default_icon] --&gt;</span><br><span class="line">        &lt;activity</span><br><span class="line">            android:name=&quot;com.google.firebase.quickstart.fcm.MainActivity&quot;</span><br><span class="line">            android:label=&quot;@string/app_name&quot;&gt;</span><br><span class="line">            &lt;intent-filter&gt;</span><br><span class="line">                &lt;action android:name=&quot;android.intent.action.MAIN&quot;/&gt;</span><br><span class="line">                &lt;category android:name=&quot;android.intent.category.LAUNCHER&quot;/&gt;</span><br><span class="line">            &lt;/intent-filter&gt;</span><br><span class="line">        &lt;/activity&gt;</span><br><span class="line"></span><br><span class="line">        &lt;!-- [START firebase_service] --&gt;</span><br><span class="line">        &lt;service</span><br><span class="line">            android:name=&quot;.MyFirebaseMessagingService&quot;&gt;//继承FirebaseMessagingService 的自定义类</span><br><span class="line">            &lt;intent-filter&gt;</span><br><span class="line">                &lt;action android:name=&quot;com.google.firebase.MESSAGING_EVENT&quot;/&gt;</span><br><span class="line">            &lt;/intent-filter&gt;</span><br><span class="line">        &lt;/service&gt;</span><br><span class="line">        &lt;!-- [END firebase_service] --&gt;</span><br><span class="line">        &lt;!-- [START firebase_iid_service] --&gt;</span><br><span class="line">        &lt;service</span><br><span class="line">            android:name=&quot;.MyFirebaseInstanceIDService&quot;&gt;//继承FirebaseInstanceIDService 的自定义类</span><br><span class="line">            &lt;intent-filter&gt;</span><br><span class="line">                &lt;action android:name=&quot;com.google.firebase.INSTANCE_ID_EVENT&quot;/&gt;</span><br><span class="line">            &lt;/intent-filter&gt;</span><br><span class="line">        &lt;/service&gt;</span><br><span class="line">        &lt;!-- [END firebase_iid_service] --&gt;</span><br><span class="line">    &lt;/application&gt;</span><br><span class="line"></span><br><span class="line">&lt;/manifest&gt;</span><br></pre></td></tr></table></figure>
<p>可以看到需要自定义的实现类更少MyFirebaseMessagingService 和MyFirebaseInstanceIDService</p>
<p>MyFirebaseMessagingService.java</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br></pre></td><td class="code"><pre><span class="line">public class MyFirebaseMessagingService extends FirebaseMessagingService &#123;</span><br><span class="line"></span><br><span class="line">    private static final String TAG = &quot;MyFirebaseMsgService&quot;;</span><br><span class="line"></span><br><span class="line">    /**</span><br><span class="line">     * Called when message is received.</span><br><span class="line">     *</span><br><span class="line">     * @param remoteMessage Object representing the message received from Firebase Cloud Messaging.</span><br><span class="line">     */</span><br><span class="line">    // [START receive_message]</span><br><span class="line">    @Override</span><br><span class="line">    public void onMessageReceived(RemoteMessage remoteMessage) &#123;</span><br><span class="line">        // [START_EXCLUDE]</span><br><span class="line">        // There are two types of messages data messages and notification messages. Data messages are handled</span><br><span class="line">        // here in onMessageReceived whether the app is in the foreground or background. Data messages are the type</span><br><span class="line">        // traditionally used with GCM. Notification messages are only received here in onMessageReceived when the app</span><br><span class="line">        // is in the foreground. When the app is in the background an automatically generated notification is displayed.</span><br><span class="line">        // When the user taps on the notification they are returned to the app. Messages containing both notification</span><br><span class="line">        // and data payloads are treated as notification messages. The Firebase console always sends notification</span><br><span class="line">        // messages. For more see: https://firebase.google.com/docs/cloud-messaging/concept-options</span><br><span class="line">        // [END_EXCLUDE]</span><br><span class="line"></span><br><span class="line">        // TODO(developer): Handle FCM messages here.</span><br><span class="line">        // Not getting messages here? See why this may be: https://goo.gl/39bRNJ</span><br><span class="line">        Log.d(TAG, &quot;From: &quot; + remoteMessage.getFrom());</span><br><span class="line"></span><br><span class="line">        // Check if message contains a data payload.</span><br><span class="line">        if (remoteMessage.getData().size() &gt; 0) &#123;</span><br><span class="line">            Log.d(TAG, &quot;Message data payload: &quot; + remoteMessage.getData());</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        // Check if message contains a notification payload.</span><br><span class="line">        if (remoteMessage.getNotification() != null) &#123;</span><br><span class="line">            Log.d(TAG, &quot;Message Notification Body: &quot; + remoteMessage.getNotification().getBody());</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        // Also if you intend on generating your own notifications as a result of a received FCM</span><br><span class="line">        // message, here is where that should be initiated. See sendNotification method below.</span><br><span class="line">    &#125;</span><br><span class="line">    // [END receive_message]</span><br><span class="line"></span><br><span class="line">    /**</span><br><span class="line">     * Create and show a simple notification containing the received FCM message.</span><br><span class="line">     *</span><br><span class="line">     * @param messageBody FCM message body received.</span><br><span class="line">     */</span><br><span class="line">    private void sendNotification(String messageBody) &#123;</span><br><span class="line">        Intent intent = new Intent(this, MainActivity.class);</span><br><span class="line">        intent.addFlags(Intent.FLAG_ACTIVITY_CLEAR_TOP);</span><br><span class="line">        PendingIntent pendingIntent = PendingIntent.getActivity(this, 0 /* Request code */, intent,</span><br><span class="line">                PendingIntent.FLAG_ONE_SHOT);</span><br><span class="line"></span><br><span class="line">        Uri defaultSoundUri= RingtoneManager.getDefaultUri(RingtoneManager.TYPE_NOTIFICATION);</span><br><span class="line">        NotificationCompat.Builder notificationBuilder = new NotificationCompat.Builder(this)</span><br><span class="line">                .setSmallIcon(R.drawable.ic_stat_ic_notification)</span><br><span class="line">                .setContentTitle(&quot;FCM Message&quot;)</span><br><span class="line">                .setContentText(messageBody)</span><br><span class="line">                .setAutoCancel(true)</span><br><span class="line">                .setSound(defaultSoundUri)</span><br><span class="line">                .setContentIntent(pendingIntent);</span><br><span class="line"></span><br><span class="line">        NotificationManager notificationManager =</span><br><span class="line">                (NotificationManager) getSystemService(Context.NOTIFICATION_SERVICE);</span><br><span class="line"></span><br><span class="line">        notificationManager.notify(0 /* ID of notification */, notificationBuilder.build());</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>MyFirebaseInstanceIDService.java</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line">public class MyFirebaseInstanceIDService extends FirebaseInstanceIdService &#123;</span><br><span class="line"></span><br><span class="line">    private static final String TAG = &quot;MyFirebaseIIDService&quot;;</span><br><span class="line"></span><br><span class="line">    /**</span><br><span class="line">     * Called if InstanceID token is updated. This may occur if the security of</span><br><span class="line">     * the previous token had been compromised. Note that this is called when the InstanceID token</span><br><span class="line">     * is initially generated so this is where you would retrieve the token.</span><br><span class="line">     */</span><br><span class="line">    // [START refresh_token]</span><br><span class="line">    @Override</span><br><span class="line">    public void onTokenRefresh() &#123;</span><br><span class="line">        // Get updated InstanceID token.</span><br><span class="line">        String refreshedToken = FirebaseInstanceId.getInstance().getToken();</span><br><span class="line">        Log.d(TAG, &quot;Refreshed token: &quot; + refreshedToken);</span><br><span class="line"></span><br><span class="line">        // If you want to send messages to this application instance or</span><br><span class="line">        // manage this apps subscriptions on the server side, send the</span><br><span class="line">        // Instance ID token to your app server.</span><br><span class="line">        sendRegistrationToServer(refreshedToken);</span><br><span class="line">    &#125;</span><br><span class="line">    // [END refresh_token]</span><br><span class="line"></span><br><span class="line">    /**</span><br><span class="line">     * Persist token to third-party servers.</span><br><span class="line">     *</span><br><span class="line">     * Modify this method to associate the user&#x27;s FCM InstanceID token with any server-side account</span><br><span class="line">     * maintained by your application.</span><br><span class="line">     *</span><br><span class="line">     * @param token The new token.</span><br><span class="line">     */</span><br><span class="line">    private void sendRegistrationToServer(String token) &#123;</span><br><span class="line">        // TODO: Implement this method to send token to your app server.</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>Activiy 中依然需要检测设备 方法同GCM Activity<br>再来看FCM中的Activity</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br></pre></td><td class="code"><pre><span class="line">public class MainActivity extends AppCompatActivity &#123;</span><br><span class="line"></span><br><span class="line">    private static final String TAG = &quot;MainActivity&quot;;</span><br><span class="line"></span><br><span class="line">    @Override</span><br><span class="line">    protected void onCreate(Bundle savedInstanceState) &#123;</span><br><span class="line">        super.onCreate(savedInstanceState);</span><br><span class="line">        setContentView(R.layout.activity_main);</span><br><span class="line"></span><br><span class="line">        // If a notification message is tapped, any data accompanying the notification</span><br><span class="line">        // message is available in the intent extras. In this sample the launcher</span><br><span class="line">        // intent is fired when the notification is tapped, so any accompanying data would</span><br><span class="line">        // be handled here. If you want a different intent fired, set the click_action</span><br><span class="line">        // field of the notification message to the desired intent. The launcher intent</span><br><span class="line">        // is used when no click_action is specified.</span><br><span class="line">        //</span><br><span class="line">        // Handle possible data accompanying notification message.</span><br><span class="line">        // [START handle_data_extras]</span><br><span class="line">        if (getIntent().getExtras() != null) &#123;</span><br><span class="line">            for (String key : getIntent().getExtras().keySet()) &#123;</span><br><span class="line">                Object value = getIntent().getExtras().get(key);</span><br><span class="line">                Log.d(TAG, &quot;Key: &quot; + key + &quot; Value: &quot; + value);</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">        // [END handle_data_extras]</span><br><span class="line"></span><br><span class="line">        Button subscribeButton = (Button) findViewById(R.id.subscribeButton);</span><br><span class="line">        subscribeButton.setOnClickListener(new View.OnClickListener() &#123;</span><br><span class="line">            @Override</span><br><span class="line">            public void onClick(View v) &#123;</span><br><span class="line">                // [START subscribe_topics]</span><br><span class="line">                FirebaseMessaging.getInstance().subscribeToTopic(&quot;news&quot;);</span><br><span class="line">                // [END subscribe_topics]</span><br><span class="line"></span><br><span class="line">                // Log and toast</span><br><span class="line">                String msg = getString(R.string.msg_subscribed);</span><br><span class="line">                Log.d(TAG, msg);</span><br><span class="line">                Toast.makeText(MainActivity.this, msg, Toast.LENGTH_SHORT).show();</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;);</span><br><span class="line"></span><br><span class="line">        Button logTokenButton = (Button) findViewById(R.id.logTokenButton);</span><br><span class="line">        logTokenButton.setOnClickListener(new View.OnClickListener() &#123;</span><br><span class="line">            @Override</span><br><span class="line">            public void onClick(View v) &#123;</span><br><span class="line">                // Get token</span><br><span class="line">                String token = FirebaseInstanceId.getInstance().getToken();</span><br><span class="line"></span><br><span class="line">                // Log and toast</span><br><span class="line">                String msg = getString(R.string.msg_token_fmt, token);</span><br><span class="line">                Log.d(TAG, msg);</span><br><span class="line">                Toast.makeText(MainActivity.this, msg, Toast.LENGTH_SHORT).show();</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>不需要自行监测服务</p>
<p>至此GCM和FCM的APP端就都以配置完成，保证测试机科学上网，便可以通过FCM控制台推送消息测试。下面是配置过程中可能遇到的问题和一些解决方法。</p>
<p>1.是否配置正确，首先看应用中是否能取得token，不能–&gt;确定所有需要包名的地方填写了正确的包名，确认科学上网。</p>
<p>2.不能接收到通知，参照1.</p>
<hr>
<h2 id="Google-Map"><a href="#Google-Map" class="headerlink" title="Google Map"></a>Google Map</h2><p><a target="_blank" rel="noopener" href="https://developers.google.com/maps/documentation/android-api/?hl=zh_CN">Map API</a></p>
<p><a target="_blank" rel="noopener" href="https://developers.google.com/maps/documentation/android-api/signup">配置</a></p>
<h3 id="在-Google-Developers-Console-中创建-API-项目"><a href="#在-Google-Developers-Console-中创建-API-项目" class="headerlink" title="在 Google Developers Console 中创建 API 项目"></a>在 Google Developers Console 中创建 API 项目</h3><p><a target="_blank" rel="noopener" href="https://console.developers.google.com/flows/enableapi?apiid=maps_android_backend&keyType=CLIENT_SIDE_ANDROID">启用API</a></p>
<p><img src="http://oanvj2lsv.bkt.clouddn.com/google/api/api2.png" alt="APIs"><br>注：来自 Google 地图 Android v1 应用的现有密钥通常称为 MapView，它们无法与 v2 API 配合使用。 Google Maps Android API 采用了全新的密钥管理系统。</p>
<h3 id="向您的应用添加-API-密钥"><a href="#向您的应用添加-API-密钥" class="headerlink" title="向您的应用添加 API 密钥"></a>向您的应用添加 API 密钥</h3><p>1.在 AndroidManifest.xml 中，通过在  结束标记前插入以下元素，将其添加为 <application> 元素的子元素：</application></p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">&lt;meta-data</span><br><span class="line">        android:name=&quot;com.google.android.geo.API_KEY&quot;</span><br><span class="line">        android:value=&quot;YOUR_API_KEY&quot;/&gt;</span><br></pre></td></tr></table></figure>
<p>用您的 API 密钥替代 value 属性中的 YOUR_API_KEY。该元素会将密钥 com.google.android.geo.API_KEY 设置为您的 API 密钥的值。</p>
<p>注：如上所示，com.google.android.geo.API_KEY 是建议使用的 API 密钥元数据名称。可使用具有该名称的密钥向 Android 平台上的多个基于 Google Maps 的 API（包括 Google Maps Android API）验证身份。出于向后兼容性上的考虑，该 API 还支持 com.google.android.maps.v2.API_KEY 名称。该旧有名称只允许向 Android Maps API v2 验证身份。应用只能指定其中一个 API 密钥元数据名称。如果两个都指定，API 会抛出异常。</p>
<h3 id="导入和特殊显示的samples"><a href="#导入和特殊显示的samples" class="headerlink" title="导入和特殊显示的samples"></a><a target="_blank" rel="noopener" href="https://developers.google.com/maps/documentation/android-api/map">导入</a>和特殊显示的<a target="_blank" rel="noopener" href="https://github.com/googlemaps/android-samples/tree/master/ApiDemos/app/src/main/java/com/example/mapdemo">samples</a></h3><p>File–&gt; new–&gt; Google–&gt;Google Maps Activity<br>自动导入依赖和mainifest配置，这里manifests文件需要手动合并，依赖默认导入最新版本，编译不过建议 9.0.0。之后可以自己手动调整</p>

    </div>

    
    
    

    <footer class="post-footer">
          <div class="post-tags">
              <a href="/tags/google/" rel="tag"># google</a>
          </div>

        

          <div class="post-nav">
            <div class="post-nav-item">
                <a href="/2016/05/17/d0517/" rel="prev" title="散记_00">
                  <i class="fa fa-angle-left"></i> 散记_00
                </a>
            </div>
            <div class="post-nav-item">
                <a href="/2016/10/20/gradle_config/" rel="next" title="Gradle.build">
                  Gradle.build <i class="fa fa-angle-right"></i>
                </a>
            </div>
          </div>
    </footer>
  </article>
</div>






</div>
  </main>

  <footer class="footer">
    <div class="footer-inner">

  <div class="copyright">
    &copy; 
    <span itemprop="copyrightYear">2025</span>
    <span class="with-love">
      <i class="fa fa-heart"></i>
    </span>
    <span class="author" itemprop="copyrightHolder">Stanhe</span>
  </div>
  <div class="powered-by">由 <a href="https://hexo.io/" rel="noopener" target="_blank">Hexo</a> & <a href="https://theme-next.js.org/muse/" rel="noopener" target="_blank">NexT.Muse</a> 强力驱动
  </div>

    </div>
  </footer>

  
  <div class="toggle sidebar-toggle" role="button">
    <span class="toggle-line"></span>
    <span class="toggle-line"></span>
    <span class="toggle-line"></span>
  </div>
  <div class="sidebar-dimmer"></div>
  <div class="back-to-top" role="button" aria-label="返回顶部">
    <i class="fa fa-arrow-up fa-lg"></i>
    <span>0%</span>
  </div>

<noscript>
  <div class="noscript-warning">Theme NexT works best with JavaScript enabled</div>
</noscript>

</body>
</html>
